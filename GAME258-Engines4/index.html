<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>GAME 258</title>
	<link rel="stylesheet" type="text/css" href="../HumberStyle.css" media="all" />
</head>
<body>
	<div id="header"> <b>GAME 258 Game Engines 4 </b><br /></div>
	<ul class="nav">
		<li class="nav"><a class="nav" href="../index.html"> Home </a><br /></li>
		<li class="nav"><a class="nav" href="../MySchedule"> My schedule </a><br /></li>
		<li class="nav"><a class="nav" href="../AboutMe"> About me </a><br /></li>
		<li class="nav"><a class="nav" href="../ETC"> /etc </a><br /></li>
	</ul>
	<div id="rightsidebar">
		<h3> Helpful tools</h3>
		<a class="nav" href="../Rubrics/programmingRubric.html" target="_blank">General Programming Rubric</a><br />
		<hr />
		<a class="nav" href="../GameDev.html"><B>Get GameDev</B></a><br />
		<hr />

		<h3> Base Code </h3>
		<a href="../CodeDepot/ComponentFramework24.0.0.zip"> ComponentFramework24.0.0 </a><br />
		<a href="MeshComponent.h">MeshComponent.h</a><br />
		<a href="MeshComponent.cpp">MeshComponent.cpp</a><br />
		<a href="tiny_obj_loader.h">tiny_obj_loader.h</a><br />
		<a href="ShaderComponent.h">ShaderComponent.h</a><br />
		<a href="ShaderComponent.cpp">ShaderComponent.cpp</a><br />
		<a href="MaterialComponent.h">MaterialComponent.h</a><br />
		<a href="MaterialComponent.h">MaterialComponent.h</a><br />
		<a href="Actor.h">Actor.h</a><br />
		<a href="CameraActor.cpp">CameraActor.cpp</a><br />
		<a href="CameraActor.h">CameraActor.h</a><br />
		<a href="MeshComponent.h">MeshComponent.h</a><br />

		<a href="Texture.cpp">Texture.cpp</a><br />
		<a href="UBO_Padding.h">UBO_Padding.h</a><br />
		<a href="http://www.grinninglizard.com/tinyxml2/index.html">tinyxml-2</a><br />



		<hr />
		<a href="defaultVert.glsl">defaultVert.glsl</a><br />
		<a href="defaultFrag.glsl">defaultFrag.glsl</a><br />
		<a href="textureVert.glsl">textureVert.glsl</a><br />
		<a href="textureFrag.glsl">textureFrag.glsl</a><br />
		<hr />
		<a class="nav" href="../GAME157-Graphics/Mario.obj">Mario.obj</a><br />
		<a class="nav" href="../GAME157-Graphics/Skull.obj">Skull.obj</a><br />
		<a class="nav" href="../GAME157-Graphics/mario_mime.png">mario_mime.png</a><br />
		<a class="nav" href="../GAME157-Graphics/mario_main.png">mario_main.png</a><br />
		<a class="nav" href="../GAME157-Graphics/mario_fire.png">mario_fire.png</a><br />
		<a class="nav" href="../GAME157-Graphics/skull_texture.jpg">skull_texture.jpg</a><br />
		<a class="nav" href="Hammer.obj">Hammer.obj</a><br />
		<a class="nav" href="hammer_BaseColor.png">hammer_BaseColor.png</a><br />
		<hr />
		<a class="nav" href="CheckerPiece.obj">CheckerPiece.obj</a><br />
		<a class="nav" href="Plane.obj">Plane.obj</a><br />
		<a class="nav" href="8x8_checkered_board.png">8x8_checkered_board.png</a><br />
		<a class="nav" href="8x8_checkered_board2.png">8x8_checkered_board(red & black)</a><br />
		<a class="nav" href="redCheckerPiece.png">redCheckerPiece.png</a><br />
		<a class="nav" href="blackCheckerPiece.png">blackCheckerPiece.png</a><br />
		<a class="nav" href="whiteCheckerPiece.png">whiteCheckerPiece.png</a><br />
		
		<a class="nav" href="ChessPieces.zip">ChessPieces.zip</a><br />
		<a class="nav" href="colorPickingVert.glsl">colorPickingVert.glsl</a><br />
		<a class="nav" href="colorPickingFrag.glsl">colorPickingFrag.glsl</a><br />
		
		<hr />
		<a class="nav" href="XMLProject.zip">XMLProject.zip</a><br />
	</div>

	<H1> Welcome to Game 258 - Game Engines 4 </H1>
	<H3>ECS <u>E</u>ntity <u>C</u>omponent <u>S</u>ystem</H3>
	
	<ul>
		<p>
		</p>
		<li><b>Topic 0:</b> Templates in C++ and other tools<br /></li>

		We'll do some experiments with C++ templates in this second demo.
		<br />
		<a href="../CodeDepot/TemplateDemo.zip">TemplateDemo.zip</a>
		<br />



		This a version of our real starting point
		<a href="../CodeDepot/ComponentFramework25.0.0.zip"> ComponentFramework25.0.0</a>,
		<br />
		download it. We will start by incorporating the demo project into the FrameWork.
		<br />
		</p>

		<p>
		</p>
		<li><b>Topic 1:</b> The Entity (Actor or Component)</li>
		Using the Actor/Component demo code we created over the last one or two classes, begin inserting these ideas in to the framework - I will guide you, promise.
		<br />
		</p>

		<!--
		<p>
		</p>
		<li><b>Topic 2:</b> The Components and Actors</li>
		Let's create some basic components and begin to flesh them out: TransformComponent, MeshComponent, Actor, and CameraActor.
		<br />

		</p>

		<p>
		</p>
		<li><b>Topic 3:</b> Using the Components</li>
		In this part we'll get and set data in and out of the added components.
		<br />
		</p>

		<p>
		</p>
		<li><b>Topic 4:</b> Using Components to render an Actor in 3D. <i> (Finally some graphics)</i></li>
		Get Mario on the screen!
		<br />
		</li>
		</p>

		<p>
		</p>
		<li><b>Topic 5:</b> Parenting objects </li>
		Once you have mario on the screen, I need you to make the following modification to the Actor class:
		

		<textarea class="code" cols=127 rows=13 spellcheck="false">
		Matrix4 Actor::GetModelMatrix() {
			TransformComponent* transform = GetComponent<TransformComponent>();
			if (transform) {
				modelMatrix = transform->GetTransformMatrix();
			} else {
				modelMatrix.loadIdentity();
			}
			if (parent) { /// <== LOOK AT IT!  Think!
				modelMatrix = dynamic_cast<Actor*>(parent)->GetModelMatrix() * modelMatrix;
			}
			return modelMatrix;
		}
		</Actor*></TransformComponent></textarea>
		<br />
		<br />

		From here you could parent one actor to another. On the website I have a hammer.obj and a texture for it. Can you put
		the hammer in Mario's hand and have it move with him?
		<br />
		</p>
		</li>

		<li>
			<b> Assignment 1: Feb 23</b>
			<p>
				<a href="Assignment1.html">Making a Checkerboard with Checkers </a>
			</p>
		</li>

		<li><b>Topic 7:</b> Better Memory Management - Smart Pointers</li>
		In this next section, I'll show you how smart pointers work, and in our current application, how shared_ptr can be helpful.
		<br />
		<br />


		In this next section, we'll look at unique_ptr,  weak_ptr, and why everything should at least be a shared_ptr.
		<br />
		<br />

		<li><b>Topic 8:</b> Better, better Memory Management - Applying smart pointers to the engine</li>
		Based on what we did last week or two, let's use the following code definition:
		<p>
			<textarea class="code" spellcheck="false" rows=4>

					template<typename T>
					using Ref = std::shared_ptr<T>;

			</textarea><br/>
			You'll need to #include<memory> header file at the top.	
		</p>


		The best place to put this declaration is, near the top of Component.h
		<br />
		<br />

		Next, we'll need to modifly the Actor.h file a bit to handle this new Ref() definition.
		I can use the std::make_shared idea plus simplify the existing code to look like this:
		<br />

		<textarea class="code" spellcheck="false" rows=11>
		template<typename ComponentTemplate>
		void AddComponent(Ref<ComponentTemplate> component_) {
			if (GetComponent<ComponentTemplate>().get() != nullptr) {
#ifdef _DEBUG
				std::cerr << "WARNING: Trying to add a component type that is already added - ignored\n";
#endif
			return;
		}
		components.push_back(component_);
}	
		</textarea>

		<br />
		<br />
		Delete all the old AddComponent() stuff and add the new stuff to your project.
		<br />
		We will also need to write a overload the AddComponent() method to accept an already existing component.
		This will be necessary for the implimentation of the asset manager. This overload will look very much like
		the one listed above. The easiest approch is just to copy the original and make this simple modification.
		<br />

		<textarea class="code" spellcheck="false" rows=14>
	template<typename ComponentTemplate, typename ... Args>
	void AddComponent(Args&& ... args_) {
		/// before you add the component ask if you have the component in the list already,
		/// if so - don't add a second one. 
		if (GetComponent<ComponentTemplate>().get() != nullptr) {
#ifdef _DEBUG
			std::cerr << "WARNING: Trying to add a component type that is already added - ignored\n";
#endif
			return;
		}
		/// Finish building the component and add the component to the list
		components.push_back(std::make_shared<ComponentTemplate>(std::forward<Args>(args_)...));
	}
	</textarea>
		<br />
		<br />
		Now you are going to need a new GetComponent as well
		<br />
		<textarea class="code" spellcheck="false" rows=13>
	template<typename ComponentTemplate>
	Ref<ComponentTemplate> GetComponent() const {
	for (auto component : components) {
		if (dynamic_cast<ComponentTemplate*>(component.get())) {
			/// This is a dynamic cast designed for shared_ptr's
			/// https://en.cppreference.com/w/cpp/memory/shared_ptr/pointer_cast
			return std::dynamic_pointer_cast<ComponentTemplate>(component);
		}
	}
	return Ref<ComponentTemplate>(nullptr);
}
	</textarea><br/><br/>
	Now on to Actor.cpp, replace RemoveAllComponents() with<br/>
		<textarea class="code" spellcheck="false" rows=5>
	template<typename ComponentTemplate>
	void Actor::RemoveAllComponents() {
		components.clear();
	}
	</textarea><br/><br/>
	In GetModelMatrix() you will only need to change one line. This will be the first time you'll use 
		a Ref to a component.<br/>
		Ref<TransformComponent> transform  = GetComponent<TransformComponent>(); <br/>
		Get it? <br/><br/>

<li>
	<b> Assignment 2: <a href="Assignment2.html">Switch from raw pointers to all Refs (shared_ptr) </a>	
</li>
<li>
	<b> Assignment 3: <a href="Assignment3.html"> Build an Asset Manager</a><br/>	
</li>
<li>
	<b> Assignment 4: <a href="Assignment4.html"> Color Picking</a><br/>	
</li>

-->
	</ul>

</body>
</HTML>
